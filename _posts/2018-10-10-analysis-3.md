---
layout: post
title: '이리의 데이터 분석 도전기3 - 주식 데이터 분석 project'
author: Idea
date: 2018-10-10 18:30
tags: [data-analytics,time-series-analysis]
image: /files/covers/time.jpg
---

# 시계열 데이터의 처리

## <span style="color:LightCoral"> 주식데이터 분석 프로젝트 </span>
이 시리즈를 생각하게 된 계기는 학교에서 배운것을 데이터 분석으로 표현해보고 싶었기 때문입니다.
그러나 금융'이론'을 제가 공부해온 데이터 분석지식으로 어떻게 다뤄볼지는 고민이 많았고 특히 시계열 데이터의 처리에 대해 고심하고 있었습니다.
그 와중, 제가 구현하려는 최종결과에 가장 fit!한 논문을 찾았습니다.

*<span style="color:LightCoral"> 박종일. “계열 데이터 전처리와 특징 선택을 활용한
기계 학습 기반의 주가 예측 모델". 서강대학교 , 2016. </span>*

이 논문의 프레임 워크는 다음과 같습니다.
![프레임 워크_박종일](/assets/post_image/paperstructure.jpg)

그리고, 주식을 완벽히 예측할 수 있다면 교수님께서 이 자리에 있지 않을 것이라는 말씀도 덧붙이셨죠..! 그만큼 투자분야, 특히 주식은 공부하면 공부할수록 저는 '워렌버핏' 쪽 보다는 '한낱 개미'에 불과함을 느꼈습니다.
그런데, 교수님께서는 이런 희망의 말도 덧 붙이셨습니다. "추세 정도는 알 수 있겠지". 그런 아이디어에서 시작된 것이 숱한 금융통계에 관한 이론들이었습니다. 데이터 분석가를 꿈꾸는 한 사람으로서 과연 주식데이터를 머신러닝/딥러닝 기법으로 분석해 낸다면 그 성능은 기존의 이론들을 능가할 지 궁금해 졌습니다. '개미이긴 하더라도 똑똑한개미는 될 수 있지 않을까?' 하는 생각에서 출발해 보았습니다.

### 1. 데이터
fnguide에서 제공하는 DataGuide를 사용하여 2000.09~2018.09 총 19년간의 일별데이터를 사용할 것입니다.

### 2. 사전조사
[전제]
Risk : 분산, 표준편차
Return : 수익률 (평균)
*- 이 정의들에 대해 투자론에서 배운 것들도 흥미롭기 때문에 향후 따로 다룰 기회를 가지도록 하겠습니다. -*

처음 하는 시계열 데이터 분석이기 때문에 다른 사람들은 어떻게 데이터를 다루었는지 조사가 필요했습니다. 이번 일지에서 참고한 논문은 크게 세개입니다.

**<span style="color:darkorange"> [1] 박성현(2017),주식데이터를 활용한 시계열데이터에서의 예측모형 비교 </span>**

전통적 시계열 자료의 분석은 시계열이 여러 요인으로 구성되어 있다고 봅니다.
1. **불규칙요인(irregular component)**: 시간에따라 규칙적으로 움직이지 않는 Random한 요인으로 통계적인 방법으로 설명이 불가능한 요인
1. **규칙요인(Regular component)**: 불규칙요인과는 반대로 규칙성을 가지는 요인
1. **추세요인(trend component)**:시간이 경과함에따라 지속적으로 증가하거나 감소하는 요인. 반드시 직선일 필요는 없음
1. **계절요인(Seasonal component)**: 계절에 의한 주기적인 요인
1. **순환요인 (Cycle component)** 계절에 의한 주기적인 변동이 아니라 경기순환과 같 이 큰 주기를 가지는 요인

이전까지의 많은 금융통계학적 접근으로도 줄이기 힘들었던 부분이 1번 불규칙 요인일것입니다. 시계열 데이터를 다루는 데 있어 2,3,4,5요인을 지각하고 접근해야 한다는 것을 알게되었고 머신러닝/딥러닝 기법을 통해 1번요인을 줄여보고자 하는 목표가 생겼습니다.

또한, 해당 논문에서 사용한 예측모형은 다음과 같습니다.
1. **지수평활법**: 일종의 가중평균법. 과거로 갈수록 가중치를 지속적으로 감소시키는 방법 등이 있다. 평균이 시간에 대해 거의 일정하거나 천천히 변하는 자료에 적합.
1. **ARIMA Model**: 과거의 관측값과 오차를 사용해서 현재의 시계열 값을 설명하는 ARMA모델을 일반화한것. ARMA모델이 안정적 시계열(Stationary Series)에만 적용가능한것에 비해 분석대상이 약간은 비안정적 시계열 (Non Stationary Series)의 특징을 보여도 적용이 가능하다! [이때, 안정화 과정이 필요하긴 하다. 자세한건 여기클릭](http://www.dodomira.com/2016/04/21/arima_in_r/ )
1. **SVR** : SVM은 Vapnik(1998)에 의해 처음 소개된 기법으로 보통 분류예측에 좋은 성능을 가진 것으로 알려져 있지만 임의의 실수 값을 예측할 수 있도록 SVM을 일반화한 방법이 SVR이다.
1. **Generalized Additive Model (GAM)** : 비선형자료의 분석에 있어서 선형회귀모형으로 적합하면 제곱항 세제곱항 을 집어넣으면 변수가 많아지는 문제가 발생할 수 있다. 선형회귀 모형의 경우 단일변수에 적합하는데 유용하지만 GAM의 장점은 각각에 비선형 함수를 적합할 수 있어 표준적 선형회귀로는 놓치게 될 비선형 관계를 자동적으로 모델링할 수 있다.

예측모형들을 하나씩 읽어보다 ARIMA에 대해 좀 더 관심을 갖게 되었습니다. 일단, 이 모델을 사용하기 위해서는 '안정적 시계열'을 가진 데이터여야 하는데, 안정적 시계열이란 다음의 3가지 특징을 만족해야 합니다.
1. 시간의 추이와 관계없이 '평균'이 불변
1. 시간의 추이와 관계없이 '분산'이 불변
1. 두 시점 간 공분산이 기준시점과 무관

아직 세번째 조건에 대해서는 확실하게 이해하지 못했기 때문에 더 공부해서 ARMIA에 대해 한번 더 얘기하겠습니다. 여튼, 이러한 조건을 만족하지 않는다면 시계열자료를 안정적 시계열로 변환할 필요성이 있으며 **"차분"** 과 **"로그함수(log)"** 를 통해 바꿀 수 있습니다.

**<span style="color:darkorange"> [2] 이상준(2013),개별종목의 등락률과 거래대금을 이용한 트레이딩 시스템 개발 및 수익성에 관한 연구 </span>**

트레이딩 시스템 개발에 관한 논문을 통해 어떤 식으로 분석을 실행해 매수까지 자동화 할 수 있는지에 대한 자세한 과정을 알 수 있었습니다. 이 논문에서는 2006년 01월 01일부터 2013년 10월 14일까지의 8년간의 일 별 종가 데이터를 사용해서 트레이딩 시스템을 개발하고 검증해 냈으며, 특히나 시스템을 개발하기 위해 사용된 전략이 인상깊었습니다.
1. 일별 주가 등락률 상위 종목 중 등락률 상위 100개 종목을 선택
1. 일별 주가 거래대금 상위 종목 중 거대대금 상위 100개 종목을 선택
1. 첫번째와 두번째 종목 중 교집합을 통하여 선택된 종목들을 선정
1. KOSPI200구성종목을 선택
1. 세번째 과정에서 선택된 종목과 네 번째 과정에서 선택된 종목 중 교집합을 통하여 선별된 종목들을 최종적으로 선택

**<span style="color:darkorange"> [3] 조혜진·서지훈·최진탁(2015),주식 뉴스 콘텐츠를 활용한 오피니언마이닝 기반의 OAR 감성사전 알고리즘 기법</span>**

하나의 피쳐로 증권사 리포트나 주식뉴스를 텍스트마이닝하여 스코어로 만들어 넣어보려는 생각을 하고 있었던 차에 찾은 논문입니다.

외국인 친구들에게 한국어를 가르쳐 본 후에서야 느낀 것이지만, 한국말은 결코 쉽지 않은 언어입니다. 예를 들어
***"주식이 상승하였지만 하락세로 마감하였다 "***
이와 같은 문장은 결국 주식이 하락했단 것이 최종 결론이기에 단순히 긍정으로 인식하게 된다면 문제가 될 수 있습니다.

또한, 특정 테마, 즉 주식시장에서만 차별적으로 인식되는 단어가 있을 수 있습니다.
***"금리하락"***
이는 보통 경기침체를 나타내는 부정적 성향이 짙은 단어이지만 주식시장에서는 일반적으로 호재로 인식되기도 합니다.

그 외에도 특정단어는 긍정적이지만 저체문장은 부정적일 가능성도 존재한다는 가정하의 Association Rule, 그리고 접속어에 따라 반어법이 유도되는 역접관계를 고려하는 점을 통해 해당 연구는 '오피니언 반의어 규칙(OAR)'절차를 만들었습니다. 이를통해 기존의 감성사전을 이용한 오피니언수치와 OAR감성사전을 기반으로 한 평판지수를 주식데이터와 각각 얼마나 밀접한지 실험을 실시했고, 꽤 유의미한 결과를 얻었습니다.

이 논문을 통해서, 순진하게 생각했던 '텍스트 마이닝'이 얼마나 큰 일인지 실감하게 되었습니다. 만들어서 하나의 피쳐로 삼기에는 아깝다는 생각이 들정도로요. 하지만 그만큼 재미있다고 생각하기 때문에 이번 프로젝트에서 힘 닿는데 까지 도전할 생각입니다.

---

 여기까지가 본격적인 데이터 분석에 앞서 1차적으로 조사한 것들입니다. 아직 시계열데이터에 대한 지식이 부족해서 이해도를 위해 한국자료들을 먼저 찾았으나 앞으로는 가리지 않고 좀 더 조사를 할 계획입니다.
 분석 툴은 파이썬으로 진행할 것이며 이번기회에 시계열 데이터를 다루는 법 + 딥러닝 기법에 대해 열심히 공부하고 적용해 보겠습니다.

![꿈.gif](https://media1.tenor.com/images/a2840757fedd75fa3ad23e9114182c60/tenor.gif?itemid=5453265)

---
Reference:
-  좋은 논문을 써주신 박종일님께 감사드리며 혹시 이 포스팅에서 reference와 관련한 문제가 있다면 알려주신다면 바로 시정하도록 하겠습니다. (juyoungsarachoi@naver.com으로 메일 주십시오)
- Photo by Elena Koycheva on Unsplash
